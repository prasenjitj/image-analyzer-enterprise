<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status - Enterprise Image Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="{{ url_for('static', filename='css/shared-ui-components.css') }}" rel="stylesheet">

    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border: 1px solid #e5e7eb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .stat-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
            border-color: #d946ef;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-connected {
            background-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        .status-error {
            background-color: #ef4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }

        .status-warning {
            background-color: #f59e0b;
            box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
        }

        .metric-trend {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .metric-trend.up {
            color: #10b981;
        }

        .metric-trend.down {
            color: #ef4444;
        }

        .auto-refresh {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Mobile Hamburger Menu Button -->
    <button class="sidebar-toggle fixed top-4 left-4 z-40 lg:hidden" aria-label="Toggle sidebar navigation"
        aria-expanded="false" aria-controls="sidebar-nav">
        <i class="fas fa-bars text-xl"></i>
    </button>

    <!-- Sidebar Navigation -->
    <nav id="sidebar-nav" class="sidebar-nav" role="navigation" aria-label="Main navigation">

        <!-- Sidebar Header -->
        <div class="sidebar-header">
            <div class="sidebar-header-content">
                <div class="sidebar-header-logo">
                    <i class="fas fa-chart-line sidebar-header-logo-icon"></i>
                </div>
                <span class="sidebar-header-text">System Status</span>
            </div>
        </div>

        <!-- Navigation Items -->
        <ul class="sidebar-nav-list">
            <li>
                <a href="/" class="nav-item" role="menuitem">
                    <i class="fas fa-tachometer-alt nav-item-icon"></i>
                    <span class="nav-item-label">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="/admin" class="nav-item" role="menuitem">
                    <i class="fas fa-cogs nav-item-icon"></i>
                    <span class="nav-item-label">Administration</span>
                </a>
            </li>
            <li>
                <a href="/system/status" class="nav-item" role="menuitem" aria-current="page">
                    <i class="fas fa-chart-line nav-item-icon"></i>
                    <span class="nav-item-label">System Status</span>
                </a>
            </li>
            <li>
                <a href="/export/template" class="nav-item" role="menuitem">
                    <i class="fas fa-download nav-item-icon"></i>
                    <span class="nav-item-label">Export Templates</span>
                </a>
            </li>
        </ul>

        <!-- Sidebar Footer - Auto Refresh Info -->
        <div class="sidebar-footer" role="status" aria-live="polite" aria-label="Auto-refresh status">
            <div class="status-section-title">
                <i class="fas fa-sync-alt" style="animation: spin 2s linear infinite; display: inline;"></i>
                Auto-Refresh
            </div>
            <div class="status-text">
                <span class="text-white text-sm">Updating every 30s</span>
            </div>
            <div class="status-meta">Last update: <span id="lastUpdate">now</span></div>
        </div>
    </nav>

    <!-- Main Content Wrapper -->
    <div class="main-with-sidebar">
        <!-- Top Navigation Bar -->
        <div
            class="flex items-center justify-between px-6 py-4 bg-white shadow-sm border-b border-gray-200 mb-8 rounded-lg">
            <div class="flex items-center">
                <button class="lg:hidden p-2 rounded-md text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="ml-4">
                    <h1 class="text-2xl font-bold text-gray-900">System Status</h1>
                    <p class="text-sm text-gray-600 mt-1">Real-time monitoring of enterprise image processing
                        infrastructure</p>
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button class="p-2 text-gray-600 hover:bg-gray-100 rounded-full transition-colors">
                        <i class="fas fa-bell"></i>
                    </button>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                </div>
                <div
                    class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white text-sm"></i>
                </div>
            </div>
        </div>

        <!-- System Health Overview -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Database Status -->
            <div class="stat-card rounded-2xl p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Database</h3>
                        <div class="flex flex-col">
                            <div class="flex items-center">
                                <span
                                    class="status-indicator {% if database_status == 'connected' %}status-connected{% else %}status-error{% endif %}"></span>
                                <span
                                    class="text-sm font-medium {% if database_status == 'connected' %}text-green-600{% else %}text-red-600{% endif %}">
                                    {{ 'Connected' if database_status == 'connected' else 'Disconnected' }}
                                </span>
                            </div>
                            {% if error_details and database_status != 'connected' %}
                            <div class="mt-1 text-xs text-red-500">
                                {{ error_details }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-database text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Redis Status -->
            <div class="stat-card rounded-2xl p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Redis Cache</h3>
                        <div class="flex items-center">
                            <span
                                class="status-indicator {% if redis_status == 'connected' %}status-connected{% else %}status-error{% endif %}"></span>
                            <span
                                class="text-sm font-medium {% if redis_status == 'connected' %}text-green-600{% else %}text-red-600{% endif %}">
                                {{ 'Connected' if redis_status == 'connected' else 'Disconnected' }}
                            </span>
                        </div>
                    </div>
                    <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-memory text-red-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Overall Health -->
            <div class="stat-card rounded-2xl p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">System Health</h3>
                        <div class="flex items-center">
                            {% set overall_status = 'connected' if database_status == 'connected' and redis_status
                            == 'connected' else 'error' %}
                            <span
                                class="status-indicator {% if overall_status == 'connected' %}status-connected{% else %}status-error{% endif %}"></span>
                            <span
                                class="text-sm font-medium {% if overall_status == 'connected' %}text-green-600{% else %}text-red-600{% endif %}">
                                {{ 'Healthy' if overall_status == 'connected' else 'Issues Detected' }}
                            </span>
                        </div>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-heart text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Statistics -->
        {% if system_stats %}
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-chart-line text-purple-600 mr-3"></i>
                    System Statistics
                </h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-purple-600 mb-2">{{ system_stats.total_batches or 0 }}
                        </div>
                        <div class="text-sm text-gray-500">Total Batches</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-blue-600 mb-2">{{ system_stats.active_batches or 0 }}
                        </div>
                        <div class="text-sm text-gray-500">Active Batches</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600 mb-2">{{ system_stats.total_urls_processed or
                            0 }}</div>
                        <div class="text-sm text-gray-500">URLs Processed</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-indigo-600 mb-2">{{
                            "%.1f"|format(system_stats.overall_success_rate or 0) }}%</div>
                        <div class="text-sm text-gray-500">Success Rate</div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Queue Statistics -->
        {% if system_stats and system_stats.queue_stats %}
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-layer-group text-indigo-600 mr-3"></i>
                    Queue Status
                </h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-blue-600">{{ system_stats.queue_stats.pending or
                                    0 }}</div>
                                <div class="text-sm text-blue-700">Pending Jobs</div>
                            </div>
                            <i class="fas fa-clock text-blue-500 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-orange-600">{{
                                    system_stats.queue_stats.processing or 0 }}</div>
                                <div class="text-sm text-orange-700">Processing</div>
                            </div>
                            <i class="fas fa-cog fa-spin text-orange-500 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-green-600">{{ system_stats.queue_stats.completed
                                    or 0 }}</div>
                                <div class="text-sm text-green-700">Completed</div>
                            </div>
                            <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Configuration Information -->
        {% if config %}
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-cogs text-gray-600 mr-3"></i>
                    Configuration
                </h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Database Configuration</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Host:</span>
                                <span class="font-medium">{{ config.database_url.split('@')[1].split('/')[0] if
                                    config.database_url else 'N/A' }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Database:</span>
                                <span class="font-medium">{{ config.database_url.split('/')[-1] if
                                    config.database_url else 'N/A' }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Pool Size:</span>
                                <span class="font-medium">{{ config.database_pool_size }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Max Overflow:</span>
                                <span class="font-medium">{{ config.database_max_overflow }}</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Processing Configuration</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Chunk Size:</span>
                                <span class="font-medium">{{ config.chunk_size }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Max Workers:</span>
                                <span class="font-medium">{{ config.max_workers }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Max Concurrent Batches:</span>
                                <span class="font-medium">{{ config.max_concurrent_batches }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Request Timeout:</span>
                                <span class="font-medium">{{ config.request_timeout }}s</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    </div>

    <script>
        // Auto-refresh functionality
        function refreshStatus() {
            location.reload();
        }

        // Refresh every 30 seconds
        setInterval(refreshStatus, 30000);

        // Sidebar toggle functionality
        function initSidebarToggle() {
            const sidebarToggle = document.querySelector('.sidebar-toggle');
            const sidebarNav = document.getElementById('sidebar-nav');

            if (!sidebarToggle || !sidebarNav) return;

            // Toggle sidebar on button click
            sidebarToggle.addEventListener('click', () => {
                const isOpen = sidebarNav.classList.toggle('open');
                sidebarToggle.setAttribute('aria-expanded', isOpen);
            });

            // Close sidebar when a nav item is clicked
            const navItems = sidebarNav.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    sidebarNav.classList.remove('open');
                    sidebarToggle.setAttribute('aria-expanded', 'false');
                });
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth < 1024) {
                    if (!sidebarNav.contains(e.target) && !sidebarToggle.contains(e.target)) {
                        sidebarNav.classList.remove('open');
                        sidebarToggle.setAttribute('aria-expanded', 'false');
                    }
                }
            });

            // Handle keyboard (Escape to close)
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    sidebarNav.classList.remove('open');
                    sidebarToggle.setAttribute('aria-expanded', 'false');
                }
            });
        }

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', () => {
            initSidebarToggle();

            // Update last refresh time
            const lastUpdateEl = document.getElementById('lastUpdate');
            if (lastUpdateEl) {
                lastUpdateEl.textContent = new Date().toLocaleTimeString();
                setInterval(() => {
                    lastUpdateEl.textContent = new Date().toLocaleTimeString();
                }, 5000);
            }
        });
    </script>
</body>

</html>